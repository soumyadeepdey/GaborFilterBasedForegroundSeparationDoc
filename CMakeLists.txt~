cmake_minimum_required(VERSION 2.8)
project( TG )
set(BUILD_SHARED_LIBS OFF)



IF(WIN32)

  SET(GSL_MINGW_PREFIX "c:/msys/local" )
  SET(GSL_MSVC_PREFIX "$ENV{LIB_DIR}")
  FIND_LIBRARY(GSL_LIB gsl PATHS 
    ${GSL_MINGW_PREFIX}/lib 
    ${GSL_MSVC_PREFIX}/lib
    )
  #MSVC version of the lib is just called 'cblas'
  FIND_LIBRARY(GSLCBLAS_LIB gslcblas cblas PATHS 
    ${GSL_MINGW_PREFIX}/lib 
    ${GSL_MSVC_PREFIX}/lib
    )

  FIND_PATH(GSL_INCLUDE_DIR gsl/gsl_blas.h 
    ${GSL_MINGW_PREFIX}/include 
    ${GSL_MSVC_PREFIX}/include
    )

  IF (GSL_LIB AND GSLCBLAS_LIB)
    SET (GSL_LIBRARIES ${GSL_LIB} ${GSLCBLAS_LIB})
  ENDIF (GSL_LIB AND GSLCBLAS_LIB)
  
ELSE(WIN32)
  IF(UNIX) 
    SET(GSL_CONFIG_PREFER_PATH "$ENV{GSL_HOME}/bin" CACHE STRING "preferred path to GSL (gsl-config)")
    FIND_PROGRAM(GSL_CONFIG gsl-config
      ${GSL_CONFIG_PREFER_PATH}
      $ENV{LIB_DIR}/bin
      /usr/local/bin/
      /usr/bin/
      )
    # MESSAGE("DBG GSL_CONFIG ${GSL_CONFIG}")
    
    IF (GSL_CONFIG) 
      # set CXXFLAGS to be fed into CXX_FLAGS by the user:
      SET(GSL_CXX_FLAGS "`${GSL_CONFIG} --cflags`")
      
      # set INCLUDE_DIRS to prefix+include
      EXEC_PROGRAM(${GSL_CONFIG}
        ARGS --prefix
        OUTPUT_VARIABLE GSL_PREFIX)
      SET(GSL_INCLUDE_DIR ${GSL_PREFIX}/include CACHE STRING INTERNAL)

      # set link libraries and link flags
      EXEC_PROGRAM(${GSL_CONFIG}
          ARGS --libs
          OUTPUT_VARIABLE GSL_LIBRARIES)
      
      ## extract link dirs for rpath  
      EXEC_PROGRAM(${GSL_CONFIG}
        ARGS --libs
        OUTPUT_VARIABLE GSL_CONFIG_LIBS )

      ## split off the link dirs (for rpath)
      ## use regular expression to match wildcard equivalent "-L*<endchar>"
      ## with <endchar> is a space or a semicolon
      STRING(REGEX MATCHALL "[-][L]([^ ;])+" 
        GSL_LINK_DIRECTORIES_WITH_PREFIX 
        "${GSL_CONFIG_LIBS}" )
        #      MESSAGE("DBG  GSL_LINK_DIRECTORIES_WITH_PREFIX=${GSL_LINK_DIRECTORIES_WITH_PREFIX}")

      ## remove prefix -L because we need the pure directory for LINK_DIRECTORIES
      
      IF (GSL_LINK_DIRECTORIES_WITH_PREFIX)
        STRING(REGEX REPLACE "[-][L]" "" GSL_LINK_DIRECTORIES ${GSL_LINK_DIRECTORIES_WITH_PREFIX} )
      ENDIF (GSL_LINK_DIRECTORIES_WITH_PREFIX)
      SET(GSL_EXE_LINKER_FLAGS "-Wl,-rpath,${GSL_LINK_DIRECTORIES}" CACHE STRING INTERNAL)
      #      MESSAGE("DBG  GSL_LINK_DIRECTORIES=${GSL_LINK_DIRECTORIES}")
      #      MESSAGE("DBG  GSL_EXE_LINKER_FLAGS=${GSL_EXE_LINKER_FLAGS}")

      #      ADD_DEFINITIONS("-DHAVE_GSL")
      #      SET(GSL_DEFINITIONS "-DHAVE_GSL")
      MARK_AS_ADVANCED(
        GSL_CXX_FLAGS
        GSL_INCLUDE_DIR
        GSL_LIBRARIES
        GSL_LINK_DIRECTORIES
        GSL_DEFINITIONS
      )
      
    ELSE(GSL_CONFIG)

      IF (GSL_FIND_REQUIRED)
         MESSAGE(FATAL_ERROR "Could not find gsl-config. Please set it manually. GSL_CONFIG=${GSL_CONFIG}")
      ELSE (GSL_FIND_REQUIRED)
         MESSAGE(STATUS "Could not find GSL")
         # TODO: Avoid cmake complaints if GSL is not found
      ENDIF (GSL_FIND_REQUIRED)

    ENDIF(GSL_CONFIG)

  ENDIF(UNIX)
ENDIF(WIN32)


IF(GSL_LIBRARIES)
  IF(GSL_INCLUDE_DIR OR GSL_CXX_FLAGS)

    SET(GSL_FOUND 1)
    
    MESSAGE(STATUS "Using GSL from ${GSL_PREFIX}")

  ENDIF(GSL_INCLUDE_DIR OR GSL_CXX_FLAGS)
ENDIF(GSL_LIBRARIES)



find_package( OpenCV REQUIRED )

if (OpenCV_FOUND)
   include_directories(${OpenCV_INCLUDE_DIRS})
endif()

find_library(XercesLibrary NAMES xerces-c PATHS /usr/local/lib)
if(NOT XercesLibrary)
  message(FATAL_ERROR "Failed to find the Xerces library.")
endif()



set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -msse -msse2 -msse3")


SET(ALETHIA_PARSER_HEADERS
				AlethiaParser/AlethiaParser.h
								)
SET(ALETHIA_PARSER_SOURCE
				AlethiaParser/AlethiaParser.cpp
								)

SET(Alglib_Source	
			alglib/ap.cpp 
			alglib/alglibinternal.cpp 
			alglib/alglibmisc.cpp 
			alglib/linalg.cpp 
			alglib/specialfunctions.cpp 
			alglib/statistics.cpp
			alglib/alglibmisc.cpp
			alglib/ap.cpp
			alglib/dataanalysis.cpp
			alglib/diffequations.cpp
			alglib/fasttransforms.cpp
			alglib/integration.cpp
			alglib/interpolation.cpp
			alglib/linalg.cpp
			alglib/optimization.cpp
			alglib/solvers.cpp
			alglib/specialfunctions.cpp
			alglib/statistics.cpp
						  )
			
 SET(Alglib_Headers 	
 			alglib/alglibinternal.h
 			alglib/alglibmisc.h
 			alglib/ap.h
 			alglib/dataanalysis.h
 			alglib/diffequations.h
 			alglib/fasttransforms.h
 			alglib/integration.h
 			alglib/interpolation.h
 			alglib/linalg.h
 			alglib/optimization.h
 			alglib/solvers.h
 			alglib/specialfunctions.h
 			alglib/statistics.h
 			alglib/stdafx.h)


SET(PLS_SOURCE		
			pls/base64.cpp  
			pls/encoding.cpp 
			pls/maths.cpp  
			pls/model.cpp  
			pls/pls.cpp  
			pls/Storage.cpp
						)

SET(PLS_HEADERS
			pls/headers.h			
			pls/base64.h  
			pls/encoding.h 
			pls/maths.h  
			pls/model.h  
			pls/pls.h  
			pls/storage.h
						)			


SET(TG_HEADERS 	  
				StandardHeaders.h
				StatisticalFunctions.h
				sorting.h
				folder.h
				GaborAngleFeature.h
				Morphology.h
				ColorQuantization.h
				SmoothingGapfilling.h
				Image_proc_functions.h
				binarization.h
				RectangleTest.h
				connectedcomponent.h
				PixelValidation.h
				PrepareAlethiaGT.h
				SegmentationUnit.h
				GradientFeature.h
				FeatureExtraction.h
				StrokeWidth.h
				ScalarColorFeature.h
				GeneralFunctions.h
				MultiClassClassificationMetrics.h
				classification.h
				CCCN_Classifier.h
				ConcensusBasedClustering.h
				ClusteringClassification.h
				WriteintoXML.h
				RunLengthFeature.h
				SpatialAndAotocorrelatedFeature.h
					)  


SET(TG_SOURCES     
				main.cpp  
				StatisticalFunctions.cpp
				sorting.cpp
				folder.cpp
				GaborAngleFeature.cpp
				Morphology.cpp
				ColorQuantization.cpp
				SmoothingGapfilling.cpp
				Image_proc_functions.cpp
				binarization.cpp
				RectangleTest.cpp
				connectedcomponent.cpp
				PixelValidation.cpp
				PrepareAlethiaGT.cpp
				SegmentationUnit.cpp
				GradientFeature.cpp
				FeatureExtraction.cpp
				StrokeWidth.cpp
				ScalarColorFeature.cpp
				GeneralFunctions.cpp
				MultiClassClassificationMetrics.cpp
				classification_new.cpp
				CCCN_Classifier.cpp				
				#classification.cpp
				ConcensusBasedClustering.cpp
				ClusteringClassification.cpp
				WriteintoXML.cpp
				RunLengthFeature.cpp
				SpatialAndAotocorrelatedFeature.cpp
					)
				


# Or set it globally for all targets:
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

ADD_EXECUTABLE(gabor ${TG_HEADERS} ${TG_SOURCES} ${PLS_SOURCE} ${PLS_HEADERS} ${ALETHIA_PARSER_HEADERS} ${ALETHIA_PARSER_SOURCE} ${Alglib_Source})
TARGET_LINK_LIBRARIES(gabor ${OpenCV_LIBS} ${XercesLibrary} ${GSL_LIBRARIES})
set(CMAKE_BUILD_TYPE Debug)

